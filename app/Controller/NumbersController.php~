<?php
App::uses('Number','Model');
class NumbersController extends AppController {
    public $helpers = array('Html', 'Form');
    public $components = array('Session');

    public function index() {
	$students = $this->Student->find(
				      'all', 
				      array('order' => 'Student.id DESC')
					);
	$this->set('students', $students);
    }

    public function add() {
	if ($this->request->is('post')) {
	    $this->Student->create();
	    if ($this->Student->save($this->request->data)) {
		$this->Session->setFlash(__('The student was sucessfully added to the database'));
		return $this->redirect(array('action' => 'index'));
	    }
	    $this->Session->setFlash(___('Unable to add the student to the database'));
	}
	
	$studentnumber = new Number();
	$data =  array('id' => 1, 'lastnumberused' => 2);
	$studentnumber->save($data);
	
    }

    public function edit($id = null) {
	if (!$id){
	    throw new NotFoundException(__('Invalid Student'));
	}
	$students = $this->Student->findById($id);
	if (!$students){
	    throw new NotFoundException(__('Invalid Student'));
	}
	if ($this->request->is(array('post', 'put'))){
	    $this->Student->id = $id;
	    if ($this->Student->save($this->request->data)){
		$this->Session->setFlash(__('Records for %s %s, Student number: %s have been been updated.',
					    $this->request->data['Student']['surname'], 
					    $this->request->data['Student']['othernames'], 
					    $this->request->data['Student']['studentnumber']));
		return $this->redirect(array('action' => 'index'));
	    }
	    $this->Session->setFlash(__('Unable to update Student Records.'));
	}
	if (!$this->request->data){
	    $this->request->data = $students;
	}
    }

    public function delete($id){
	if ($this->request->is('get')){
	    throw new MethodNotAllowedException();
	}
	$students = $this->Student->findById($id);
	if ($this->Student->delete($id)){
		$this->Session->setFlash(__('Records for %s %s, Student number: %s have been been deleted.',
					    $students['Student']['surname'], 
					    $students['Student']['othernames'], 
					    $students['Student']['studentnumber']));
	    return $this->redirect(array('action' => 'index'));
	}
    }
}
?>